
# Lezione: Installazione di Red Hat Advanced Cluster Management (RHACM)

## prima di questa sezione fai

```
lab install do0011l ; lab start install-rhacm
```

Mostra dal vivo l'installazione e poi lascia il lab agli studenti

( NO SLIDES)


## Obiettivo della lezione

Questa sezione spiega **come installare correttamente RHACM Operator e MultiClusterHub** su OpenShift, con un focus esplicito su **ambienti Telco**, **Zero Touch Provisioning (ZTP)** e **modalit√† disconnected**.

Al termine, lo studente sar√† in grado di:

* Capire *perch√©* RHACM va installato in un certo modo (non solo *come*)
* Installare RHACM in ambienti connected e disconnected
* Fare scelte consapevoli su **namespace, update channel e update strategy**
* Capire il ruolo del **MultiClusterHub** come punto di controllo della fleet
* Riconoscere e risolvere i problemi tipici di installazione in contesti Telco

---

---

## Prerequisiti (checklist Telco)

Prima di iniziare:

* Cluster OpenShift **stabile** (tipicamente dedicato come Hub)
* Sizing adeguato (CPU / RAM) trovate nella documentazione di ACM delle linee guida
* Accesso a:

  * OperatorHub (connected)
  * **Mirror registry locale** (disconnected)
 

---

## Installazione dell‚ÄôRHACM Operator

### 4.1 Metodo raccomandato: OperatorHub

Dal **Web Console OpenShift**:

1. Operators ‚Üí OperatorHub
2. Cercare **Advanced Cluster Management for Kubernetes**
3. Selezionare l‚Äôoperator Red Hat

Questo metodo √® valido **sia in connected che in disconnected**, a patto che:

* In disconnected l‚ÄôOperatorHub sia correttamente popolato via mirror

Link: disconnected environment:
https://docs.redhat.com/en/documentation/red_hat_advanced_cluster_management_for_kubernetes/2.15/html-single/multicluster_global_hub/index#global-hub-install-disconnected


---

### 4.2 Scelta dell‚ÄôUpdate Channel

Gli update channel:

* Corrispondono a **minor release** (es. 2.11, 2.12, 2.13)
* Definiscono **quali versioni sono visibili** all‚Äôoperator

Namespace raccomandato:

```
open-cluster-management
```

Perch√©:

* Standard de-facto
* Supportato ufficialmente
* Separazione chiara dai workload applicativi

Update Strategy: Automatic vs Manual

Questa √® una delle **scelte pi√π importanti**.

#### Automatic

* Upgrade automatici dell‚Äôoperator
* Nessun intervento umano

‚ùå **Sconsigliato in Telco**

#### Manual (raccomandato)

* Ogni upgrade richiede approvazione
* Pieno controllo del lifecycle


Dopo aver cliccato *Install*:

* Attendere il check verde
* Verificare i pod nel namespace

```
oc get pods -n open-cluster-management
```

---

## 5. Creazione del MultiClusterHub

### 5.1 Perch√© √® obbligatorio

L‚Äôoperator **non installa automaticamente** RHACM.

Serve il CR:

```
kind: MultiClusterHub
```

üëâ √à qui che decidiamo **come** ACM funzioner√†.

---

### 5.2 Creazione via YAML (approccio ZTP-friendly)

```yaml
apiVersion: operator.open-cluster-management.io/v1
kind: MultiClusterHub
metadata:
  name: multiclusterhub
  namespace: open-cluster-management
spec: {}
```

Applicazione:

```
oc apply -f multiclusterhub.yaml
```

 
In uno scenario di ZTP, √® importante che nella Advanced configuration settate disableUpdateClusterImageSets=true.
Questo disabilita gli aggiornamenti dell'immagine del cluster. In questo modo:

-Git √® l‚Äôunica source of truth
-ArgoCD applica
-ACM non interferisce

Link:
https://docs.redhat.com/en/documentation/red_hat_advanced_cluster_management_for_kubernetes/2.15/html/install/installing#disable-update-cluster-image-sets




Altra property interessante √® disableHubSelfManagement che disabilita l'import del Local Cluster come managed cluster


---

### 5.3 Fasi di installazione

* Phase: Installing
* Phase: Running

Tempo tipico: **alcuni minuti**

Verifica:

```
oc get multiclusterhub -n open-cluster-management
```

---

## 6. Connected vs Disconnected: cosa cambia davvero

### Connected

* OperatorHub online
* Immagini scaricate da Red Hat
* Meno preparazione

### Disconnected (Telco tipico)

Richiede:

* Mirror di:

  * Operator
  * CatalogSource
  * Immagini RHACM
* Registry locale

Problemi tipici:

* Pod in Pending
* ImagePullBackOff

---

## 7. Uso di Infrastructure Nodes

Qui c'√® una annotazione importante, dal punto di vista del consumo

RHACM pu√≤ girare su **infra nodes**:

* Non consumano subscription worker
* Isolano il control plane

Configurabile via:

* nodeSelector
* tolerations

Tecnicamente, un nodo Infra nasce come un nodo Worker comune. √à l'amministratore che lo trasforma aggiungendo delle etichette (Label):

Label: node-role.kubernetes.io/infra: ""

Taint: Si aggiunge un "Taint" (un divieto) che dice: "Qui le app normali non possono entrare".

In questo modo, crei un'area riservata del cluster dove RHACM pu√≤ girare senza "rubare" risorse alle applicazioni aziendali e senza pesare sul portafoglio delle licenze.

 

---

## 8. Accesso alla console RHACM

Dopo l‚Äôinstallazione:

* Cluster switcher ‚Üí **All Clusters**
* Compare la console RHACM

Qui vedrai:

* Hub cluster
* Managed cluster (quando aggiunti)

---

## 9. Troubleshooting dell‚Äôinstallazione

### 9.1 Operator in Pending

Errore tipico:

```
Unschedulable
Insufficient cpu
Untolerated taint
```

Cause comuni:

* Sizing insufficiente
* Infra/master taint non tollerato
* Immagini non disponibili (disconnected)

---

### 9.2 Checklist di debug

* `oc get pods -n open-cluster-management`
* `oc describe pod <pod>`
* Verificare registry locale
* Verificare risorse nodi

---

 
 

 
