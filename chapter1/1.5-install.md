# Lezione: Installazione di Red Hat Advanced Cluster Management (RHACM)

## Obiettivo della lezione

Questa lezione spiega **come installare correttamente RHACM Operator e MultiClusterHub** su OpenShift, con un focus esplicito su **ambienti Telco**, **Zero Touch Provisioning (ZTP)** e **modalit√† disconnected**.

Al termine, lo studente sar√† in grado di:

* Capire *perch√©* RHACM va installato in un certo modo (non solo *come*)
* Installare RHACM in ambienti connected e disconnected
* Fare scelte consapevoli su **namespace, update channel e update strategy**
* Capire il ruolo del **MultiClusterHub** come punto di controllo della fleet
* Riconoscere e risolvere i problemi tipici di installazione in contesti Telco

---

## 1. Contesto Telco: perch√© RHACM √® critico

In ambienti Telco abbiamo tipicamente:

* **Decine o centinaia di cluster** (core, edge, far edge)
* **Provisioning automatizzato** (ZTP)
* **Cicli di vita lunghi e controllati**
* **Aggiornamenti pianificati e non automatici**
* **Ambienti disconnected o air-gapped**

üëâ RHACM diventa il **control plane della fleet**, non un semplice tool opzionale.

Per questo:

* L‚Äôinstallazione **non √® banale**
* Le scelte fatte ora (channel, update, namespace) hanno impatto operativo a lungo termine

---

## 2. Architettura logica dell‚Äôinstallazione

Prima di installare, √® fondamentale capire cosa stiamo installando:

* **RHACM Operator**

  * Vive nel cluster Hub
  * Gestisce il lifecycle dei componenti ACM

* **MultiClusterHub (CR)**

  * Istanzia *tutti* i servizi RHACM
  * √à il vero ‚Äúinterruttore di accensione‚Äù di ACM

> Senza MultiClusterHub, l‚Äôoperator √® installato ma ACM **non esiste**.

---

## 3. Prerequisiti (checklist Telco)

Prima di iniziare:

* Cluster OpenShift **stabile** (tipicamente dedicato come Hub)
* Sizing adeguato (CPU / RAM)
* Accesso a:

  * OperatorHub (connected)
  * **Mirror registry locale** (disconnected)
* Decisione chiara su:

  * Update channel
  * Update strategy

üëâ In ambienti Telco, queste decisioni **NON sono opzionali**.

---

## 4. Installazione dell‚ÄôRHACM Operator

### 4.1 Metodo raccomandato: OperatorHub

Dal **Web Console OpenShift**:

1. Operators ‚Üí OperatorHub
2. Cercare **Advanced Cluster Management for Kubernetes**
3. Selezionare l‚Äôoperator Red Hat

Questo metodo √® valido **sia in connected che in disconnected**, a patto che:

* In disconnected l‚ÄôOperatorHub sia correttamente popolato via mirror

---

### 4.2 Scelta dell‚ÄôUpdate Channel

Gli update channel:

* Corrispondono a **minor release** (es. 2.11, 2.12, 2.13)
* Definiscono **quali versioni sono visibili** all‚Äôoperator

üî¥ **Best practice Telco**:

* Usare un channel **specifico e stabile**
* Evitare channel ‚Äúmoving target‚Äù

Motivo:

* ZTP richiede **riproducibilit√†**
* Gli upgrade devono essere **controllati e testati**

---

### 4.3 Namespace di installazione

Namespace raccomandato:

```
open-cluster-management
```

Perch√©:

* Standard de-facto
* Supportato ufficialmente
* Separazione chiara dai workload applicativi

‚ö†Ô∏è Anche se tecnicamente installabile altrove, **non √® consigliato** in produzione Telco.

---

### 4.4 Update Strategy: Automatic vs Manual

Questa √® una delle **scelte pi√π importanti**.

#### Automatic

* Upgrade automatici dell‚Äôoperator
* Nessun intervento umano

‚ùå **Sconsigliato in Telco**

#### Manual (raccomandato)

* Ogni upgrade richiede approvazione
* Pieno controllo del lifecycle

‚úÖ **Scelta corretta per**:

* ZTP
* Disconnected
* Ambienti regolamentati

---

### 4.5 Completamento installazione

Dopo aver cliccato *Install*:

* Attendere il check verde
* Verificare i pod nel namespace

```
oc get pods -n open-cluster-management
```

---

## 5. Creazione del MultiClusterHub

### 5.1 Perch√© √® obbligatorio

L‚Äôoperator **non installa automaticamente** RHACM.

Serve il CR:

```
kind: MultiClusterHub
```

üëâ √à qui che decidiamo **come** ACM funzioner√†.

---

### 5.2 Creazione via YAML (approccio ZTP-friendly)

```yaml
apiVersion: operator.open-cluster-management.io/v1
kind: MultiClusterHub
metadata:
  name: multiclusterhub
  namespace: open-cluster-management
spec: {}
```

Applicazione:

```
oc apply -f multiclusterhub.yaml
```

Per ZTP:

* Questo file entra in Git
* Viene applicato automaticamente

---

### 5.3 Fasi di installazione

* Phase: Installing
* Phase: Running

Tempo tipico: **alcuni minuti**

Verifica:

```
oc get multiclusterhub -n open-cluster-management
```

---

## 6. Connected vs Disconnected: cosa cambia davvero

### Connected

* OperatorHub online
* Immagini scaricate da Red Hat
* Meno preparazione

### Disconnected (Telco tipico)

Richiede:

* Mirror di:

  * Operator
  * CatalogSource
  * Immagini RHACM
* Registry locale

Problemi tipici:

* Pod in Pending
* ImagePullBackOff

---

## 7. Uso di Infrastructure Nodes

RHACM pu√≤ girare su **infra nodes**:

* Non consumano subscription worker
* Isolano il control plane

Configurabile via:

* nodeSelector
* tolerations

üëâ **Altamente raccomandato** in ambienti Telco

---

## 8. Accesso alla console RHACM

Dopo l‚Äôinstallazione:

* Cluster switcher ‚Üí **All Clusters**
* Compare la console RHACM

Qui vedrai:

* Hub cluster
* Managed cluster (quando aggiunti)

---

## 9. Troubleshooting dell‚Äôinstallazione

### 9.1 Operator in Pending

Errore tipico:

```
Unschedulable
Insufficient cpu
Untolerated taint
```

Cause comuni:

* Sizing insufficiente
* Infra/master taint non tollerato
* Immagini non disponibili (disconnected)

---

### 9.2 Checklist di debug

* `oc get pods -n open-cluster-management`
* `oc describe pod <pod>`
* Verificare registry locale
* Verificare risorse nodi

---

 
 

 
